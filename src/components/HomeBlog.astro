---
import { getCollection } from "astro:content";

// const posts = await Astro.glob('../../content/blog/**/*.md');
const posts = await getCollection('blog');
const postCount = 5;
const postsToShow = posts
    .filter(post => !post.data.draft && post.data.title)
    .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime())
    .slice(0, postCount)
;
---
<script is:inline define:vars={{ posts }}>
console.log('CONTENT', posts)
</script>
<section>
    <h2>Blog</h2>

    {postsToShow.length && postsToShow.map((post) => (
        <article>
            <h3>{post.data.title}</h3>
            {(post.data.description ?? '') && (
                <p>{post.data.description}</p>
            )}
            {/* TODO figure out how to link to the blog article */}
            <a href={post.url}>Read more</a>
        </article>
    ))}

    <pre set:html={JSON.stringify(posts, undefined, 2)}></pre>
    <!-- <ul>
    <li>list</li>
    <li>of</li>
    <li>posts</li>
    </ul> -->
</section>
